# 使用IP时间戳模式特性检测虚拟机类型

## 概要

在本文中，我们提出了一种虚拟机检测方法，我们认为它可以用于远程检测虚拟机环境。该检测方法通过分析从目标环境发送的应答中的IP时间戳模式来工作。该方法不需要在目标机器上安装任何软件，如果恶意软件使用该方法来检测VM环境，则会进一步增加其潜在危害。在本文中，我们还介绍了一种技术，可以伪装真实的PC机，使其显示出与VM类似的IP时间戳模式。通过使用这种技术，恶意软件可能无法区分真实的机器和虚拟机，从而为PC终端用户提供保护。


## 介绍

我们认为使用VM的恶意软件检测安全系统可能有一个严重的漏洞。也就是说，恶意软件可能试图首先检测它将运行的环境。通过这样的VM检测，恶意软件的创建者可以编写程序，在检测到VM环境时不会执行有害操作，如僵尸网络攻击，从而降低了他们的行为被研究和暴露的风险。通过恶意软件检测系统的任何应用程序都被认为是安全的，可能会得到用户的信任，这对移动设备用户也会造成严重的后果。

VM检测问题已经被研究者广泛讨论。有许多技术可以检测VM是否存在。但是，检测程序在主机上安装并执行后所做的检测方法被认为是将使用的最后一种方法。这是因为如果该程序或软件安装在主机上，就有可能被检测到其存在，并产生签名，从而暴露其存在。

在本文中，我们提出了一种检测VM环境的方法，通过远程检测VM，而无需在目标机器上安装任何程序。它通过分析从目标机器发送的响应中的IP时间戳模式来确定目标机器是真实机器还是虚拟机。

在实验中，我们从测试客户端向目标机器发送了启用了IP时间戳选项的请求包。通过在请求包中启用IP时间戳选项，来自目标计算机的应答包将包含时间戳，显示在目标计算机中生成应答包的时间。为了进行比较，使用vm和一个真实的机器作为目标机器。VM是开放平台的流行虚拟化产品，即VMWare、Oracle VirtualBox和Xen被用作VM目标机的管理程序，而真正的机器运行开源Ubuntu Linux作为本机操作系统

我们的发现表明，通过分析来自目标机器的响应中的IP时间戳模式，我们能够区分VM和真正的机器环境。也就是说，我们的实验结果证明了应答报文中存在一个特征的IP时间戳模式，可以用来检测VM环境。这是因为VM是通过共享时间的主机物理硬件工作的，即使VM使用了一些技术来最小化和隐藏时间性能上的差异，VM也不可能复制物理真实机器的计时活动。


作为这种VM远程检测方法的对策，我们建议在与VM相同的环境中伪装一个真实的机器，这样它就会返回与VM相同的IP时间戳模式。在这里，我们建议使用数学公式来编辑真实机器的系统，以在时间戳应答数据包中创建延迟。通过这个公式，来自真实机器的IP时间戳模式变得与来自VM环境的类似。当恶意软件或攻击者无法区分VM或真实机器环境时，该对策可以为真实机器提供保护。



## 研究背景

vm通常被用作恶意软件检测的蜜罐或模拟器。虚拟机之所以被使用，是因为它们的环境很容易被恶意软件感染后恢复。虚拟机安装在虚拟化环境中的主机上。VM管理程序有两种类型。类型1管理程序或裸机实现直接运行在服务器硬件上，下面没有任何操作系统，而类型2管理程序运行在传统的操作系统上。类型2管理程序易于安装和部署，因为网络和存储等大部分硬件配置工作都是由底层操作系统处理的。虚拟机采用一种动态启发式方法来扫描和检测恶意软件。如果扫描到的任何程序被检测为恶意软件，它很容易在VM环境中被隔离和分析，不可能或几乎不可能对VM管理程序或主机造成任何损害。

然而，即使使用VM作为防御恶意软件的重要优点，这个想法仍然是脆弱的，因为恶意软件可能检测到它正在或将要运行的系统，从而区分VM环境。通过VM检测，攻击者可以设计恶意软件，在执行任何恶意或安全破坏操作之前，首先尝试检测系统是否在VM上运行。此外，一旦达到这一点，攻击可能从仅仅检测VM升级到利用VM本身[6,19]。我们还预测，针对移动设备的应用程序软件的安全性测试将使用云计算环境中的vm中的模拟器完成。我们假设应用程序测试的结果可能不是真的，特别是针对各种恶意代码的安全测试，因为如果恶意操作已经检测到运行的环境是VM，那么它们可能不会显示其真实性质。因此，当应用程序发布时，安装它的移动设备可能会受到威胁
[Virtual Machines Detection Methods Using IP Timestamps Pattern Characteristic](http://aircconline.com/ijcsit/V8N1/8116ijcsit01.pdf)